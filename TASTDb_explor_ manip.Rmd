---
title: "Exploration et manipulation du tableau de données *Voyages*"
author: "Wilfrid Cariou"
date: "20 décembre 2015"
output:
  word_document:
    toc: yes
  html_document:
    number_sections: yes
    toc: yes
---

# Manipulations du tableau de données *voyages*
## Manipulation des colonnes 
### Sélection de colonnes
#### Sélection de colonnes en utilisant **R-base**

La syntaxe employée utilise une notation basée sur l'usage des crochets et des virgules:  
[lignes,colonnes]   
L'ommission d'un élement permet de sélectionner une ligne ou une colonne entiere.  
[,colonnes]   
[lignes,]  

* Le mode le plus simple de sélection consiste à indiquerla position d'index des colonnes à conserver. 

````{r eval=FALSE}

# dans cet exemple, les colonnes 1 et 2

handld_columns1<- (voyages[,1:2]) 

````

* Un autre mode d'indexation consiste à sélectionner des colonnes par la saisie des noms de variable. (fonction *c(combine)*.

````{r eval=FALSE}

handld_columns2 <- voyages[,c("voyageid","ptdepimp")] 


````

* Suppression de colonnes  

```{r eval = FALSE}

# Suppression de la colonne située en dixième position 
handld_columns3 <- voyages[,-10] 


```


#### Sélection de colonnes en utilisant la fonction select {dplyr} 

````{r eval=FALSE}

# Sélection des colonnes 1 et 2

handld_columns4 <- voyages %>%
                        select (1:2)

# Sélection des colonnes voyageid et shipname
handld_columns6 <- voyages %>%
                        select(voyageid, shipname)

# Sélection des colonnes 1 à 10
handld_columns5 <- voyages %>%
                        select(1:10)


# Sélection de l'ensemble dess colonnes, expectées la colonne 11
handld_columns6 <- voyages %>%
                        select(-(11))

````


### Réagencement des colonnes du tableau de données
#### Réagencement en utilisant la fonction *combine {base}* et la notation crochet.

```{r eval=FALSE}

# Exemple du déplacement de la colonne  yearam à la seconde position du tableau


# Position de yearam

which(colnames(voyages)=="yearam") # résultat: yearam = 54

# Déplacement
handld_columns7a- (voyages[,c(1,54,2:105)]) 


# Suppression de la colonne yearam intiale se situant désormais en 55e position
handld_columns7b- (voyages[,-55])

```


#### Réagencement en utilisant la fonction select {dplyr} 

* Les réagencements effectués ne "doublonnent pas les colonnes" déplacées.  
* Des fonctions complémentaires facilitent la sélection des colonnesdans certains cas (dplyr spreadsheet, https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)

```{r eval=FALSE}

handld_columns8sa <- voyages %>%
                select(1,54,2:105)

handld_columns8a <- voyages %>%
                select(1,yearam,2:105)

```


#### Réagencement des colonnes selon l'ordre alphabétique

```{r eval = FALSE}

alphabet_data <- voyages %>%
                 select (order(colnames(.)))

```


##  Sélection des lignes

### Sélection de lignes en fonction d'une colonne

#### Cas des caractères qualitatifs

##### Sélection selon la modalité d'un caractère qualitatif (ou catégoriel)

Exemple de la modalité *Nantes*, appartenant au caractère *ptdepimp* (ports de départ des expéditions de traite).


###### Notation crochet et fonction subset{base} 

````{r eval=FALSE}

nantessub1 <- subset(voyages, ptdepimp=="Nantes")

````


###### Fonction filter {dplyr}

````{r eval=FALSE}

nantes <- voyages %>% 
               filter (ptdepimp == "Nantes")

````


##### Sélection par exclusion d'une sous-chaîne de caractères

La sélection s'effectue par une expression régulière introduite par une fonction d'identification et utilisant le signe ! (point d'exclamation) comme opérateur d'exclusion.

```{r eval = FALSE}

ports_identified <- voyages %>% 
                     filter(!grepl("unspecified", ptdepimp))

# ou

ports_identified <- voyages %>% 
                     filter(!str_detect(ptdepimp, "unspecified"))

```

##### Sélection selon une combinaison de modalités appartenant à un caractère

La sélection s'effectue par une expression régulière introduite par une fonction d'identification et utilisant le signe | (barre verticale) comme opérateur d'alternation.


* Recherche d'un motif comportant une alternation  

````{r eval = FALSE}

grepl("Bristol|London", voyages$ptdepimp) # base

# Ou

str_detect (voyages$ptdepimp, "Bristol|London") # package stringr

````

* Combinaison des fonctions filter et des fonctions d'identification de motif  

````{r eval = FALSE}

bristol_london <- voyages %>% 
                   filter( grepl("Bristol|London", ptdepimp)) # base
# ou 

bristol_london <- voyages %>% 
                   filter( str_detect(ptdepimp, "Bristol|London")) #stringr

````

##### Sélection en fonction d'une sous-chaîne commune à un ensemble de modalités

```{r eval = FALSE}

armateur <- tst_db %>%
            filter(grepl("Montaudouin", ownera))

```


#### Cas des variables quantitatives

##### Sélection selon une valeur quantitative

````{r eval=FALSE}

year1789 <- voyages %>%
            filter(yearam == 1789)

````


#### Sélection selon une combinaison de valeurs

```{r eval = FALSE}

p_1600_1605 <- voyages %>%
                    filter(yearam >= 1600 & yearam < 1605 )

```


### Sélection de lignes en fonction de différentes colonnes


#### Combinaison port de départ / navire particulier

```{r eval=FALSE}

nante_db <- voyages %>%
            filter (ptdepimp == "Nantes" & shipname == "Duc de Bretagne")

# ou

nante_db <- voyages %>%
            filter (ptdepimp == "Nantes", shipname == "Duc de Bretagne")
# ou

nante_db <- voyages %>%
            filter (ptdepimp == "Nantes") %>%
            filter (shipname == "Duc de Bretagne")

```

## Tri, fonction arrange {dplyr}

Dplyr fait appel à la fonction *arrange*  pour trier le contenu des colonnes du tableau de données. Cette dernière classe les valeurs par ordre croissant et les modalités par ordre alphabétique. Un classement par ordre décroissant s'obtient par l'ajout de l'argument *desc*.

```{r eval=FALSE}

# Classement  en fonction de l'année de débarquement des esclaves
datachrono <- voyages %>%
                arrange (yearam)

# Classement  en fonction du nom des navires
shipnames<- voyages %>%
                arrange (shipname)

# Classement  en fonction de l'année du nombre d'esclaves embarqués
slaves_emb<- voyages %>%
                arrange (desc(slaximp))

```



## Recherche de combinaisons uniques: exemple de l'identification des navires


Identification des navires caractérisés par un nom et un tonnage similaires.

```{r eval = FALSE}

unique_ships1 <-voyages %>% 
                 distinct(shipname, tonnage) %>%
                 arrange(shipname)

````


## Omission des données manquantes

L'omission des données manquantes s'effectue à l'aide la fonction complete.cases {stats}
```{r eval = FALSE}

non_na <-  voyages %>%
                  filter(complete.cases(guns))

```



